import{l as H,r as v,s as J,C as P,W as g,f as d,o as u,a as r,b as s,u as l,m as K,g as h,t as f,d as B,w,e as _,i as Q,p as Z,F as D,q as I}from"./app-lBFWFbO3.js";import{_ as S}from"./InputLabel-H8ZK7EIA.js";import{_ as T}from"./TextInput-BP2iDJ_P.js";import{_ as k}from"./InputError-BLGuqF9p.js";import{P as A}from"./PrimaryButton-B4gQPJ4i.js";import{_ as ee}from"./SecondaryButton-CKTZP05A.js";import{_ as se}from"./Modal-B7Ry9LA4.js";import{_ as M}from"./SelectInput-D0UO4_8K.js";import{S as j}from"./sweetalert2.esm.all-B0Dix5B2.js";import{d as te}from"./debounce-DS9xtVAQ.js";const oe={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},re={class:"text-gray-900"},le={key:0,class:"mb-4 p-4 bg-green-100 text-green-700 rounded"},ie={key:1,class:"mb-4 p-4 bg-red-100 text-red-700 rounded"},ae={class:"mb-8 p-4 bg-gray-50 rounded-lg"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={class:"mt-4 flex justify-end"},ue={class:"mt-5"},ce={class:"pb-5 flex justify-between"},me={class:"flex items-center space-x-4"},pe={key:0,class:"p-4 bg-gray-50 rounded text-center"},fe={key:1,class:"overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-gray-50"},xe={key:0,class:"ml-1"},he={key:0,class:"ml-1"},_e={class:"bg-white divide-y divide-gray-200"},ye={class:"px-6 py-4 whitespace-nowrap"},be={class:"text-sm font-medium text-gray-900"},we={class:"px-6 py-4 whitespace-nowrap"},Se={class:"text-sm text-gray-900"},ke={class:"px-6 py-4"},Ce={class:"text-sm text-gray-900"},Re={class:"flex flex-wrap gap-1"},$e={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-right"},Ve=["onClick"],Pe=["onClick"],Ee={class:"p-6 relative overflow-visible"},Fe={class:"text-lg font-medium text-gray-900 mb-4"},Ue={class:"mt-4"},Ne={class:"mt-6 flex justify-end"},We={__name:"Index",props:{roles:Array,permissions:Array,filters:Object},setup(x){var F,U,N;const C=x,q=H(),c=v(((F=C.filters)==null?void 0:F.search)||""),m=v(((U=C.filters)==null?void 0:U.sort_field)||"name"),a=v(((N=C.filters)==null?void 0:N.sort_direction)||"asc");J(c,te(()=>{z()},300));const p=P({name:"",permissions:[]}),i=P({id:null,name:"",permissions:[]}),R=v(!1),y=v(null),n=v(!1),$=o=>{if(q.success(o),window.location.href.includes("settings")){const t={};c.value&&(t.search=c.value),m.value&&(t.sort_field=m.value),a.value&&(t.sort_direction=a.value),g.visit(route("settings.index",{tab:"roles",...t}),{preserveState:!0,preserveScroll:!0,replace:!0,only:["roles","filters"]})}else{const t={};c.value&&(t.search=c.value),m.value&&(t.sort_field=m.value),a.value&&(t.sort_direction=a.value),g.visit(route("roles.index",t),{preserveState:!0,preserveScroll:!0,replace:!0,only:["roles","filters"]})}n.value=!1},L=()=>{n.value=!0,window.location.href.includes("settings")&&p.transform(e=>({...e,_headers:{"X-From-Settings":"true"}})),p.post(route("roles.store"),{preserveScroll:!0,onSuccess:()=>{p.reset(),$("Role created successfully")},onError:()=>{n.value=!1}})},X=o=>{y.value=o,i.id=o.id,i.name=o.name,i.permissions=o.permissions.map(e=>e.id),R.value=!0},V=()=>{R.value=!1,i.reset(),y.value=null},W=()=>{n.value=!0,window.location.href.includes("settings")&&i.transform(e=>({...e,_headers:{"X-From-Settings":"true"}})),i.put(route("roles.update",i.id),{preserveScroll:!0,onSuccess:()=>{V(),$("Role updated successfully")},onError:()=>{n.value=!1}})},Y=o=>{j.fire({title:"Are you sure?",text:`You are about to delete the role "${o.name}". This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(e=>{e.isConfirmed&&O()})},O=()=>{if(!y.value)return;n.value=!0;const o=window.location.href.includes("settings");P({_method:"DELETE",_headers:o?{"X-From-Settings":"true"}:{}}).post(route("roles.destroy",y.value.id),{preserveScroll:!0,onSuccess:()=>{$("Role deleted successfully")},onError:t=>{n.value=!1,j.fire({title:"Error",text:t.message||"Failed to delete role",icon:"error"})}})};function z(){const o=window.location.pathname,e={};c.value&&(e.search=c.value),m.value&&(e.sort_field=m.value),a.value&&(e.sort_direction=a.value),o.includes("settings")?g.visit(route("settings.index",{tab:"roles",...e}),{preserveState:!0,preserveScroll:!0,replace:!0,only:["roles","filters"]}):g.visit(route("roles.index",e),{preserveState:!0,preserveScroll:!0,replace:!0,only:["roles","filters"]})}function E(o){m.value=o,a.value=a.value==="asc"?"desc":"asc";const e=window.location.pathname,t={};c.value&&(t.search=c.value),m.value&&(t.sort_field=m.value),a.value&&(t.sort_direction=a.value),e.includes("settings")?g.visit(route("settings.index",{tab:"roles",...t}),{preserveState:!0,preserveScroll:!0,replace:!0,only:["roles","filters"]}):g.visit(route("roles.index",t),{preserveState:!0,preserveScroll:!0,replace:!0,only:["roles","filters"]})}function G(o){return o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}return(o,e)=>(u(),d("div",null,[r(l(K),{title:"Role Management"}),s("div",oe,[s("div",re,[o.$page.props.flash&&o.$page.props.flash.success?(u(),d("div",le,f(o.$page.props.flash.success),1)):h("",!0),o.$page.props.flash&&o.$page.props.flash.error?(u(),d("div",ie,f(o.$page.props.flash.error),1)):h("",!0),s("div",ae,[e[8]||(e[8]=s("h3",{class:"text-lg font-medium mb-4"},"Create New Role",-1)),s("form",{onSubmit:B(L,["prevent"])},[s("div",ne,[s("div",null,[r(S,{for:"role-name",value:"Role Name"}),r(T,{id:"role-name",type:"text",class:"mt-1 block w-full",modelValue:l(p).name,"onUpdate:modelValue":e[0]||(e[0]=t=>l(p).name=t),required:""},null,8,["modelValue"]),r(k,{message:l(p).errors.name,class:"mt-2"},null,8,["message"])]),s("div",null,[r(S,{value:"Permissions"}),r(M,{modelValue:l(p).permissions,"onUpdate:modelValue":e[1]||(e[1]=t=>l(p).permissions=t),options:x.permissions,multiple:"",class:"mt-1 block w-full",placeholder:"Select permissions"},null,8,["modelValue","options"]),r(k,{message:l(p).errors.permissions,class:"mt-2"},null,8,["message"])])]),s("div",de,[r(A,{disabled:l(p).processing||n.value},{default:w(()=>[_(f(n.value?"Creating...":"Create Role"),1)]),_:1},8,["disabled"])])],32)]),s("div",null,[s("div",ue,[s("div",ce,[e[9]||(e[9]=s("div",{class:"text-xl"},"Roles",-1)),s("div",me,[s("div",null,[Q(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),placeholder:"Search roles...",class:"border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},null,512),[[Z,c.value]])]),s("button",{onClick:e[3]||(e[3]=t=>o.showModal=!0),class:"bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded"}," Add Role ")])])]),x.roles.length===0?(u(),d("div",pe," No roles found. Create your first role using the form above. ")):(u(),d("div",fe,[s("table",ve,[s("thead",ge,[s("tr",null,[s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:e[4]||(e[4]=t=>E("name"))},[e[10]||(e[10]=_(" Name ")),m.value==="name"?(u(),d("span",xe,f(a.value==="asc"?"↑":"↓"),1)):h("",!0)]),s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:e[5]||(e[5]=t=>E("created_at"))},[e[11]||(e[11]=_(" Created ")),m.value==="created_at"?(u(),d("span",he,f(a.value==="asc"?"↑":"↓"),1)):h("",!0)]),e[12]||(e[12]=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Permissions ",-1)),e[13]||(e[13]=s("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ",-1))])]),s("tbody",_e,[(u(!0),d(D,null,I(x.roles,t=>(u(),d("tr",{key:t.id},[s("td",ye,[s("div",be,f(t.name),1)]),s("td",we,[s("div",Se,f(G(t.created_at)),1)]),s("td",ke,[s("div",Ce,[s("div",Re,[(u(!0),d(D,null,I(t.permissions,b=>(u(),d("span",{key:b.id,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},f(b.name),1))),128))])])]),s("td",$e,[s("button",{onClick:b=>X(t),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Edit ",8,Ve),t.name!=="admin"?(u(),d("button",{key:0,onClick:b=>Y(t),class:"text-red-600 hover:text-red-900"}," Delete ",8,Pe)):h("",!0)])]))),128))])])]))])])]),r(se,{show:R.value,onClose:V},{default:w(()=>[s("div",Ee,[s("h2",Fe,"Edit Role: "+f(l(i).name),1),s("form",{onSubmit:B(W,["prevent"])},[s("div",null,[r(S,{for:"edit-role-name",value:"Role Name"}),r(T,{id:"edit-role-name",type:"text",class:"mt-1 block w-full",modelValue:l(i).name,"onUpdate:modelValue":e[6]||(e[6]=t=>l(i).name=t),required:""},null,8,["modelValue"]),r(k,{message:l(i).errors.name,class:"mt-2"},null,8,["message"])]),s("div",Ue,[r(S,{value:"Permissions"}),r(M,{modelValue:l(i).permissions,"onUpdate:modelValue":e[7]||(e[7]=t=>l(i).permissions=t),options:x.permissions,multiple:"",class:"mt-1 block w-full",placeholder:"Select permissions"},null,8,["modelValue","options"]),r(k,{message:l(i).errors.permissions,class:"mt-2"},null,8,["message"])]),s("div",Ne,[r(ee,{disabled:l(i).processing||n.value,onClick:V,class:"mr-3"},{default:w(()=>e[14]||(e[14]=[_(" Cancel ")])),_:1},8,["disabled"]),r(A,{disabled:l(i).processing||n.value},{default:w(()=>[_(f(n.value?"Updating...":"Update Role"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"])]))}};export{We as default};
